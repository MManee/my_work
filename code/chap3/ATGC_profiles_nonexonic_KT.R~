
par(mfrow=c(2,2))

library(seqinr)
tanay <- read.table("../../data/chap3/KT_nonexonic_block.txt", header=F)

chr2L<-read.fasta("../../../data/chap3/chromosomes/chr2L.fa")[[1]]
chr2R<-read.fasta("../../../data/chap3/chromosomes/chr2R.fa")[[1]]
chr3L<-read.fasta("../../../data/chap3/chromosomes/chr3L.fa")[[1]]
chr3R<-read.fasta("../../../data/chap3/chromosomes/chr3R.fa")[[1]]
chrX<-read.fasta("../../../data/chap3/chromosomes/chrX.fa")[[1]]

# 1kb # edge_point
fre_data <- c()
fileConn<-file("frequencies_KT_1kb_edge.txt","w")
for(i in 1:nrow(tanay))
{	start <- tanay[i,2]
	end <- tanay[i,3]
	if((tanay[i,1] == "chr2L"))
	{
		frag <- c(chr2L[(start-1001):(start-1)],chr2L[(end+1):(end+1000)])
		writeLines(frag, fileConn,sep="\n")
	}
	else if((tanay[i,1] == "chr2R"))
	{
		frag <- c(chr2R[(start-1001):(start-1)],chr2R[(end+1):(end+1000)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chr3L"))
	{
		frag <- c(chr3L[(start-1001):(start-1)],chr3L[(end+1):(end+1000)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chr3R"))
	{
		frag <- c(chr3R[(start-1001):(start-1)],chr3R[(end+1):(end+1000)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chrX"))
	{
		frag <- c(chrX[(start-1001):(start-1)],chrX[(end+1):(end+1000)])
		writeLines(frag, fileConn, sep="\n")
	}
}
close(fileConn)
fileConn<-file("frequencies_KT_1kb_edge.txt","r")
data <- readLines(fileConn)
frequencies <- numeric()
for(j in 1:2001)
{
	frequencies <- cbind(frequencies, table(data[seq(j, length(data), 2001)]))
	frequencies[,j] <- frequencies[,j]/sum(frequencies[,j])
}
close(fileConn)
x<-c(-1000:1000)
a<-predict(loess(frequencies[1,]~x,span=0.05))
c<-predict(loess(frequencies[2,]~x,span=0.05))
g<-predict(loess(frequencies[3,]~x,span=0.05))
t<-predict(loess(frequencies[4,]~x,span=0.05))
plot(x,a*100,col="green",type="l", lwd=2, main="", xlab="Distance (bp)", ylab="Frequency (%)", ylim=c(18,32), yaxt="n")
axis(2, at = seq(-18, 32, by = 2), las=2)
mtext("Tanay dataset", side = 4, cex=1.1, line= -1, las=1, at=c(35.5))
mtext("Edge-point case", side = 3, cex=0.80, line= 0.5)
lines(x, c*100,col="blue", lwd=2)
lines(x, g*100,col="orange", lwd=2)
lines(x, t*100,col="red", lwd=2)
x1<-axTicks(1)[1]
y1<-axTicks(2)[1] 
text(x1,y1+0.5,"A", col="green")
text(x1+100,y1+0.5,"T", col="red")
text(x1+200,y1+0.5,"G", col="orange")
text(x1+300,y1+0.5,"C", col="blue")

# 1kb # mid_point
fre_data <- c()
fileConn<-file("frequencies_KT_1kb_mid.txt","w")
for(i in 1:nrow(tanay))
{	start <- tanay[i,2]
	end <- tanay[i,3]
	total <- start + end
	divide <- total/2
	mid_point <- floor(divide)

	if((tanay[i,1] == "chr2L"))
	{
		frag <- c(chr2L[(mid_point-1001):(mid_point-1)],chr2L[(mid_point+1):(mid_point+1000)])
		writeLines(frag, fileConn,sep="\n")
	}
	else if((tanay[i,1] == "chr2R"))
	{
		frag <- c(chr2R[(mid_point-1001):(mid_point-1)],chr2R[(mid_point+1):(mid_point+1000)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chr3L"))
	{
		frag <- c(chr3L[(mid_point-1001):(mid_point-1)],chr3L[(mid_point+1):(mid_point+1000)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chr3R"))
	{
		frag <- c(chr3R[(mid_point-1001):(mid_point-1)],chr3R[(mid_point+1):(mid_point+1000)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chrX"))
	{
		frag <- c(chrX[(mid_point-1001):(mid_point-1)],chrX[(mid_point+1):(mid_point+1000)])
		writeLines(frag, fileConn, sep="\n")
	}
}
close(fileConn)
fileConn<-file("frequencies_KT_1kb_mid.txt","r")
data <- readLines(fileConn)
frequencies <- numeric()
for(j in 1:2001)
{
	frequencies <- cbind(frequencies, table(data[seq(j, length(data), 2001)]))
	frequencies[,j] <- frequencies[,j]/sum(frequencies[,j])
}
close(fileConn)
x<-c(-1000:1000)
a<-predict(loess(frequencies[1,]~x,span=0.05))
c<-predict(loess(frequencies[2,]~x,span=0.05))
g<-predict(loess(frequencies[3,]~x,span=0.05))
t<-predict(loess(frequencies[4,]~x,span=0.05))
plot(x,a*100,col="green",type="l", lwd=2, main="", xlab="Distance (bp)", ylab="Frequency (%)", ylim=c(18,32), yaxt="n")
axis(2, at = seq(-18, 32, by = 2), las=2)
mtext("Mid-point case", side = 3, cex=0.80, line= 0.5)
lines(x, c*100,col="blue", lwd=2)
lines(x, g*100,col="orange", lwd=2)
lines(x, t*100,col="red", lwd=2)
x1<-axTicks(1)[1]
y1<-axTicks(2)[1] 
text(x1,y1+0.5,"A", col="green")
text(x1+100,y1+0.5,"T", col="red")
text(x1+200,y1+0.5,"G", col="orange")
text(x1+300,y1+0.5,"C", col="blue")

# 100bp # edge_point
fre_data <- c()
fileConn<-file("frequencies_KT_100bp_edge.txt","w")
for(i in 1:nrow(tanay))
{	start <- tanay[i,2]
	end <- tanay[i,3]
	if((tanay[i,1] == "chr2L"))
	{
		frag <- c(chr2L[(start-101):(start-1)],chr2L[(end+1):(end+100)])
		writeLines(frag, fileConn,sep="\n")
	}
	else if((tanay[i,1] == "chr2R"))
	{
		frag <- c(chr2R[(start-101):(start-1)],chr2R[(end+1):(end+100)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chr3L"))
	{
		frag <- c(chr3L[(start-101):(start-1)],chr3L[(end+1):(end+100)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chr3R"))
	{
		frag <- c(chr3R[(start-101):(start-1)],chr3R[(end+1):(end+100)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chrX"))
	{
		frag <- c(chrX[(start-101):(start-1)],chrX[(end+1):(end+100)])
		writeLines(frag, fileConn, sep="\n")
	}
}
close(fileConn)
fileConn<-file("frequencies_KT_100bp_edge.txt","r")
data <- readLines(fileConn)
frequencies <- numeric()
for(j in 1:201)
{
	frequencies <- cbind(frequencies, table(data[seq(j, length(data), 201)]))
	frequencies[,j] <- frequencies[,j]/sum(frequencies[,j])
}
close(fileConn)
x<-c(-100:100)
a<-predict(loess(frequencies[1,]~x,span=0.05))
c<-predict(loess(frequencies[2,]~x,span=0.05))
g<-predict(loess(frequencies[3,]~x,span=0.05))
t<-predict(loess(frequencies[4,]~x,span=0.05))
plot(x,a*100,col="green",type="l", lwd=2, xlab="Distance (bp)", ylab="Frequency (%)", ylim=c(18,32), yaxt="n")
axis(2, at = seq(-18, 32, by = 2), las=2)
lines(x, c*100,col="blue", lwd=2)
lines(x, g*100,col="orange", lwd=2)
lines(x, t*100,col="red", lwd=2)
x1<-axTicks(1)[1]
y1<-axTicks(2)[1] 
text(x1,y1+0.5,"A", col="green")
text(x1+10,y1+0.5,"T", col="red")
text(x1+20,y1+0.5,"G", col="orange")
text(x1+30,y1+0.5,"C", col="blue")

# 100bp # mid_point
fre_data <- c()
fileConn<-file("frequencies_KT_100bp_mid.txt","w")
for(i in 1:nrow(tanay))
{	start <- tanay[i,2]
	end <- tanay[i,3]
	total <- start + end
	divide <- total/2
	mid_point <- floor(divide)

	if((tanay[i,1] == "chr2L"))
	{
		frag <- c(chr2L[(mid_point-101):(mid_point-1)],chr2L[(mid_point+1):(mid_point+100)])
		writeLines(frag, fileConn,sep="\n")
	}
	else if((tanay[i,1] == "chr2R"))
	{
		frag <- c(chr2R[(mid_point-101):(mid_point-1)],chr2R[(mid_point+1):(mid_point+100)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chr3L"))
	{
		frag <- c(chr3L[(mid_point-101):(mid_point-1)],chr3L[(mid_point+1):(mid_point+100)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chr3R"))
	{
		frag <- c(chr3R[(mid_point-101):(mid_point-1)],chr3R[(mid_point+1):(mid_point+100)])
		writeLines(frag, fileConn, sep="\n")
	}
	else if((tanay[i,1] == "chrX"))
	{
		frag <- c(chrX[(mid_point-101):(mid_point-1)],chrX[(mid_point+1):(mid_point+100)])
		writeLines(frag, fileConn, sep="\n")
	}
}
close(fileConn)
fileConn<-file("frequencies_KT_100bp_mid.txt","r")
data <- readLines(fileConn)
frequencies <- numeric()
for(j in 1:201)
{
	frequencies <- cbind(frequencies, table(data[seq(j, length(data), 201)]))
	frequencies[,j] <- frequencies[,j]/sum(frequencies[,j])
}
close(fileConn)
x<-c(-100:100)
a<-predict(loess(frequencies[1,]~x,span=0.05))
c<-predict(loess(frequencies[2,]~x,span=0.05))
g<-predict(loess(frequencies[3,]~x,span=0.05))
t<-predict(loess(frequencies[4,]~x,span=0.05))
plot(x,a*100,col="green",type="l", lwd=2, xlab="Distance (bp)", ylab="Frequency (%)", ylim=c(18,32), yaxt="n")
axis(2, at = seq(-18, 32, by = 2), las=2)
lines(x, c*100,col="blue", lwd=2)
lines(x, g*100,col="orange", lwd=2)
lines(x, t*100,col="red", lwd=2)
x1<-axTicks(1)[1]
y1<-axTicks(2)[1] 
text(x1,y1+0.5,"A", col="green")
text(x1+10,y1+0.5,"T", col="red")
text(x1+20,y1+0.5,"G", col="orange")
text(x1+30,y1+0.5,"C", col="blue")

# output
dev.copy(pdf,'../../data/chap3/nonexonic_KT_ATGC_profiles.pdf')
dev.off()
